<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Useless Math Engine</title>
    <!-- Use Tailwind CSS for a professional, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Courier New', 'monospace'],
                        'press-start': ['"Press Start 2P"', 'cursive']
                    },
                    colors: {
                        'primary-light': '#f8d7ff',
                        'primary-dark': '#4b0082',
                        'accent-pink': '#ff69b4',
                        'accent-purple': '#8a2be2',
                        'accent-green': '#32cd32',
                        'accent-orange': '#ffa500',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Press+Start+2P&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-effect {
            overflow: hidden;
            border-right: .15em solid #fff;
            white-space: nowrap;
            animation: 
                typing 2s steps(40, end),
                blink-caret .75s step-end infinite;
            font-family: monospace;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #fff; }
        }

        /* Useless Stickers */
        .sticker {
            position: absolute;
            width: 80px;
            height: 80px;
            font-size: 3rem;
            animation: pulse 2s infinite ease-in-out;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Stats progress bar animation */
        .stats-progress-fill {
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="bg-primary-light font-sans text-gray-800 antialiased min-h-screen flex items-center justify-center p-4 relative">
    
    <!-- Sticker elements -->
    <div class="sticker top-10 left-10 animate-pulse-slow">üçå</div>
    <div class="sticker bottom-20 right-10 animate-pulse-slow">ü§Ø</div>
    <div class="sticker top-1/4 right-1/4 animate-pulse-slow">üß†</div>
    <div class="sticker bottom-1/3 left-1/4 animate-pulse-slow">üßÆ</div>

    <!-- Main Container -->
    <div class="max-w-6xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden md:flex relative z-10">

        <!-- Left Panel: Calculator Interface -->
        <div class="md:w-1/2 p-8 lg:p-12 bg-primary-light flex flex-col justify-between">
            <a href="/" class="self-start text-primary-dark font-semibold text-lg flex items-center mb-6 hover:text-accent-purple transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Lab
            </a>
            
            <div class="flex-grow flex flex-col justify-center">
                <h1 class="text-4xl lg:text-5xl font-extrabold text-primary-dark mb-4 drop-shadow-sm font-press-start">
                    Useless Math Engine
                </h1>
                <p class="text-xl text-primary-dark/80 mb-8 italic">Solving problems nobody asked for.</p>

                <div class="bg-gray-900 text-white rounded-2xl p-6 lg:p-8 shadow-inner mb-6 relative">
                    <div id="problem-display" class="font-mono text-xl lg:text-2xl opacity-70 mb-4">
                        ‚à´ Confusion dx
                    </div>
                    <div id="result-display" class="font-extrabold text-3xl lg:text-4xl text-accent-green typing-effect">
                        = ‚àû cats
                    </div>
                </div>

                <button id="calculate-button" class="w-full bg-accent-purple text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl hover:bg-accent-purple/90 transition-all duration-300 transform active:scale-95">
                    Calculate Impossibility ü§Ø
                </button>
            </div>

            <div class="mt-8 text-primary-dark/60 text-sm">
                <p class="mb-2 font-bold text-lg">Math Facts:</p>
                <ul id="facts-list" class="list-disc list-inside space-y-1">
                    <!-- Facts will be dynamically inserted here -->
                </ul>
            </div>
        </div>

        <!-- Right Panel: History and Stats -->
        <div class="md:w-1/2 p-8 lg:p-12 bg-white flex flex-col">
            <h2 class="text-3xl font-bold text-primary-dark mb-4 font-press-start">
                Useless Stats
            </h2>
            <div id="history-container" class="flex-grow space-y-3 overflow-y-auto pr-2 mb-6">
                <!-- History items will be dynamically added here -->
            </div>
            
            <div class="bg-gray-100 rounded-2xl p-6 shadow-inner">
                <h3 class="text-2xl font-bold text-primary-dark mb-4">
                    Analytics
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Problems solved:</span>
                        <span id="problems-solved" class="text-accent-green font-extrabold text-xl">1</span>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Bananas divided:</span>
                        <span id="bananas-divided" class="text-accent-pink font-extrabold text-xl">382</span>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Math teachers crying:</span>
                        <span id="teachers-crying" class="text-accent-purple font-extrabold text-xl">1</span>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Reality Distortion Level:</span>
                        <div class="w-24 bg-gray-300 rounded-full h-4 relative">
                            <div id="distortion-level" class="stats-progress-fill h-4 bg-accent-orange rounded-full" style="width: 25%;"></div>
                            <span class="absolute top-0 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-900">25%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const calculateButton = document.getElementById('calculate-button');
        const problemDisplay = document.getElementById('problem-display');
        const resultDisplay = document.getElementById('result-display');
        const factsList = document.getElementById('facts-list');
        const historyContainer = document.getElementById('history-container');
        const problemsSolved = document.getElementById('problems-solved');
        const bananasDivided = document.getElementById('bananas-divided');
        const teachersCrying = document.getElementById('teachers-crying');
        const distortionLevel = document.getElementById('distortion-level');

        // Function to create a new typing animation
        function startTypingAnimation(element, text) {
            element.textContent = '';
            element.classList.remove('typing-effect');
            void element.offsetWidth; // Trigger reflow
            element.classList.add('typing-effect');
            element.style.setProperty('--typing-steps', text.length);
            element.textContent = text;
        }

        // Add a history item to the log
        function addHistoryItem(problem, result) {
            const historyItem = document.createElement('div');
            historyItem.className = 'bg-gray-100 p-4 rounded-xl shadow-sm text-sm fade-in';
            historyItem.innerHTML = `
                <div class="text-gray-600 font-mono italic">${problem}</div>
                <div class="font-bold text-accent-purple">${result}</div>
            `;
            historyContainer.prepend(historyItem);
        }
        
        // Initial load of content
        async function initialLoad() {
            try {
                const response = await fetch('/api/useless-math');
                const data = await response.json();
                
                // Update facts list
                factsList.innerHTML = '';
                data.facts.forEach(fact => {
                    const li = document.createElement('li');
                    li.textContent = fact;
                    factsList.appendChild(li);
                });

                // Update initial display
                problemDisplay.textContent = data.calculation.problem;
                resultDisplay.textContent = `= ${data.calculation.result}`;
                startTypingAnimation(resultDisplay, `= ${data.calculation.result}`);

                // Update stats
                problemsSolved.textContent = data.stats.problems_solved;
                bananasDivided.textContent = data.stats.bananas_divided;
                teachersCrying.textContent = data.stats.teachers_crying;
                distortionLevel.style.width = `${Math.floor(Math.random() * 100)}%`;

                // Add initial history item
                addHistoryItem(data.calculation.problem, data.calculation.result);

            } catch (error) {
                console.error("Failed to load initial data:", error);
            }
        }
        
        // Event listener for the "Calculate" button
        calculateButton.addEventListener('click', async () => {
            try {
                const response = await fetch('/api/useless-math');
                const data = await response.json();
                
                // Update displays with new calculation
                problemDisplay.textContent = data.calculation.problem;
                startTypingAnimation(resultDisplay, `= ${data.calculation.result}`);

                // Add to history and update stats after a delay for effect
                setTimeout(() => {
                    addHistoryItem(data.calculation.problem, data.calculation.result);
                    problemsSolved.textContent = data.stats.problems_solved;
                    bananasDivided.textContent = data.stats.bananas_divided;
                    teachersCrying.textContent = data.stats.teachers_crying;
                    distortionLevel.style.width = `${Math.floor(Math.random() * 100)}%`;
                }, 2000); 

            } catch (error) {
                console.error("Failed to fetch data:", error);
            }
        });

        // Load content on page load
        document.addEventListener('DOMContentLoaded', initialLoad);
    </script>
</body>   